{"title":"IDEA è¿œç¨‹ä¸€é”®éƒ¨ç½² SpringBoot åˆ° Docker","date":"2022-05-20T19:16:59.000Z","date_formatted":{"ll":"2022å¹´5æœˆ20æ—¥","L":"2022/05/20","MM-DD":"05-20"},"link":"2022/05/20/IDEA-è¿œç¨‹ä¸€é”®éƒ¨ç½²-SpringBoot-åˆ°-Docker","comments":true,"updated":"2022-11-16T02:30:28.832Z","content":"<h1 id=\"idea-è¿œç¨‹ä¸€é”®éƒ¨ç½²-springboot-åˆ°-docker\">IDEA è¿œç¨‹ä¸€é”®éƒ¨ç½² SpringBoot åˆ° Docker<a title=\"#idea-è¿œç¨‹ä¸€é”®éƒ¨ç½²-springboot-åˆ°-docker\" href=\"#idea-è¿œç¨‹ä¸€é”®éƒ¨ç½²-springboot-åˆ°-docker\"></a></h1>\n<h3 id=\"ä¸€ã€å¼€å‘å‡†å¤‡\">ä¸€ã€å¼€å‘å‡†å¤‡<a title=\"#ä¸€ã€å¼€å‘å‡†å¤‡\" href=\"#ä¸€ã€å¼€å‘å‡†å¤‡\"></a></h3>\n<ol>\n<li>\n<p>å®‰è£… Docker</p>\n<p><a href=\"https://linuxize.com/post/how-to-install-and-use-docker-on-ubuntu-20-04/\" target=\"_blank\">å¦‚ä½•åœ¨ Ubuntu 20.04 ä¸Šå®‰è£… Docker | LinuxåŒ–</a></p>\n</li>\n<li>\n<p>é…ç½®å¼€å¯ docker è¿œç¨‹è¿æ¥ç«¯å£</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Centos</span></span><br><span class=\"line\">vim /usr/lib/systemd/system/docker.service</span><br><span class=\"line\"><span class=\"comment\"># Ubuntu</span></span><br><span class=\"line\">vim /usr/lib/systemd/system/docker.service</span><br></pre></td></tr></table></figure>\n<p>åœ¨ ExecStart æœ€ååŠ ä¸Š <code>-H tcp://0.0.0.0:2375</code></p>\n<blockquote>\n<p>å¦‚æœæ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œå°±åœ¨ <code>äº‘æœåŠ¡å™¨ ECS / å®‰å…¨ç»„</code> ä¸­æ·»åŠ  TCP ç«¯å£ 2375</p>\n</blockquote>\n</li>\n<li>\n<p>åŠ è½½ docker å®ˆæŠ¤è¿›ç¨‹</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>é‡å¯ docker</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart docker</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>æµ‹è¯•æ˜¯å¦å¼€å¯æˆåŠŸ</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl http://localhost:2375/version</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>æˆ–è€…æŸ¥çœ‹ç«¯å£æ˜¯å¦æ‰“å¼€</p>\n<p>ps aux | grep docker</p>\n</blockquote>\n</li>\n<li>\n<p>è¿œç¨‹è¿æ¥æœåŠ¡å™¨ docker</p>\n<p>å¡«å†™è¿œç¨‹ docker åœ°å€</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/liuilin/image-bed@latest/blog/img/image-20211004205038877.png\" alt=\"image-20211004205038877\" class=\"Ï†bs\"></p>\n<p>Settings - Build, Execution, Deployment - Dockerï¼šæ–°åŠ  Dockerï¼Œå¹¶é…ç½® TCP socket çš„ Engine API URL ä¸º <code>tcp://æœåŠ¡å™¨ ip:2375</code></p>\n<p>è¿æ¥æˆåŠŸååœ¨ IDEA ä¸»ç•Œé¢ services çš„ dock æ æœ‰æ–°é…ç½®çš„ Docker åˆ—è¡¨ï¼ŒåŒå‡»è¿æ¥åä¼šåˆ—å‡ºè¿œç¨‹çš„ docker å®¹å™¨å’Œé•œåƒ</p>\n</li>\n</ol>\n<h3 id=\"äºŒã€å»ºé¡¹ç›®\">äºŒã€å»ºé¡¹ç›®<a title=\"#äºŒã€å»ºé¡¹ç›®\" href=\"#äºŒã€å»ºé¡¹ç›®\"></a></h3>\n<ol>\n<li>\n<p>æ”¹ pom</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;project xmlns=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">         xsi:schemaLocation=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class=\"line\">  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class=\"line\">  &lt;parent&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.xkcoding&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-demo&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;</span><br><span class=\"line\">  &lt;/parent&gt;</span><br><span class=\"line\">  &lt;groupId&gt;com.liumulin&lt;/groupId&gt;</span><br><span class=\"line\">  &lt;artifactId&gt;demo-docker1&lt;/artifactId&gt;</span><br><span class=\"line\">  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class=\"line\">  &lt;name&gt;demo-docker1&lt;/name&gt;</span><br><span class=\"line\">  &lt;description&gt;demo-docker1&lt;/description&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;properties&gt;</span><br><span class=\"line\">    &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class=\"line\">  &lt;/properties&gt;</span><br><span class=\"line\">  &lt;dependencies&gt;</span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">      &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">      &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class=\"line\">      &lt;scope&gt;test&lt;/scope&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">  &lt;/dependencies&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;build&gt;</span><br><span class=\"line\">    &lt;plugins&gt;</span><br><span class=\"line\">      &lt;plugin&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">      &lt;/plugin&gt;</span><br><span class=\"line\">      &lt;plugin&gt;</span><br><span class=\"line\">        &lt;groupId&gt;com.spotify&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;1.0.0&lt;/version&gt;</span><br><span class=\"line\">        &lt;configuration&gt;</span><br><span class=\"line\">          &lt;dockerDirectory&gt;src/main/docker&lt;/dockerDirectory&gt;</span><br><span class=\"line\">          &lt;resources&gt;</span><br><span class=\"line\">            &lt;resource&gt;</span><br><span class=\"line\">              &lt;targetPath&gt;/&lt;/targetPath&gt;</span><br><span class=\"line\">              &lt;!-- æ‰“åŒ…åˆ° target ç›®å½•ï¼Œç­‰äºçˆ¶ pom æ–‡ä»¶çš„ &lt;directory&gt;$&#123;project.basedir&#125;/target&lt;/directory&gt;--&gt;</span><br><span class=\"line\">              &lt;directory&gt;$&#123;project.build.directory&#125;&lt;/directory&gt;</span><br><span class=\"line\">              &lt;!-- ç­‰äºçˆ¶ pom æ–‡ä»¶çš„ &lt;finalName&gt;$&#123;project.artifactId&#125;-$&#123;project.version&#125;&lt;/finalName&gt;--&gt;</span><br><span class=\"line\">              &lt;include&gt;$&#123;project.build.finalName&#125;.jar&lt;/include&gt;</span><br><span class=\"line\">            &lt;/resource&gt;</span><br><span class=\"line\">          &lt;/resources&gt;</span><br><span class=\"line\">        &lt;/configuration&gt;</span><br><span class=\"line\">      &lt;/plugin&gt;</span><br><span class=\"line\">      &lt;plugin&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;executions&gt;</span><br><span class=\"line\">          &lt;execution&gt;</span><br><span class=\"line\">            &lt;phase&gt;package&lt;/phase&gt;</span><br><span class=\"line\">            &lt;configuration&gt;</span><br><span class=\"line\">              &lt;tasks&gt;</span><br><span class=\"line\">                &lt;copy todir=<span class=\"string\">&quot;src/main/docker&quot;</span></span><br><span class=\"line\">                      file=<span class=\"string\">&quot;target/$&#123;project.artifactId&#125;-$&#123;project.version&#125;.$&#123;project.packaging&#125;&quot;</span>/&gt;</span><br><span class=\"line\">              &lt;/tasks&gt;</span><br><span class=\"line\">            &lt;/configuration&gt;</span><br><span class=\"line\">            &lt;goals&gt;</span><br><span class=\"line\">              &lt;goal&gt;run&lt;/goal&gt;</span><br><span class=\"line\">            &lt;/goals&gt;</span><br><span class=\"line\">          &lt;/execution&gt;</span><br><span class=\"line\">        &lt;/executions&gt;</span><br><span class=\"line\">      &lt;/plugin&gt;</span><br><span class=\"line\">    &lt;/plugins&gt;</span><br><span class=\"line\">  &lt;/build&gt;</span><br><span class=\"line\">&lt;/project&gt;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>åœ¨ src/main ç›®å½•ä¸‹åˆ›å»º docker ç›®å½•ï¼Œå¹¶åˆ›å»º Dockerfile æ–‡ä»¶</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> openjdk:<span class=\"number\">8</span>-jdk-alpine</span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> *.jar app.jar</span></span><br><span class=\"line\"><span class=\"keyword\">ENTRYPOINT</span><span class=\"bash\"> [<span class=\"string\">&quot;java&quot;</span>,<span class=\"string\">&quot;-Djava.security.egd=file:/dev/./urandom&quot;</span>,<span class=\"string\">&quot;-jar&quot;</span>,<span class=\"string\">&quot;/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>å»º YAML</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">9090</span></span><br><span class=\"line\"><span class=\"attr\">logging:</span></span><br><span class=\"line\">  <span class=\"attr\">path:</span> <span class=\"string\">/docker/logs</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>ä¸»å¯åŠ¨ç±»</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.liumulin.demodocker1.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/hello&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">hello</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Hello,From Docker!&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>æ–°å¢ Dockerfile é…ç½®</p>\n<p>IDEA - Edit Configurationsâ€¦</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/liuilin/image-bed@latest/blog/img/deploy%20Dockerfile.jpg\" alt=\"deploy Dockerfile\" class=\"Ï†bs\"></p>\n<p>å‘½ä»¤è§£é‡Šï¼š</p>\n<p>Image tagï¼šæŒ‡å®šé•œåƒåç§°å’Œ tagï¼Œé•œåƒåç§°ä¸º docker-demoï¼Œtag ä¸º 1.1</p>\n<p>Bind portsï¼šç»‘å®šå®¿ä¸»æœºç«¯å£åˆ°å®¹å™¨å†…éƒ¨ç«¯å£ã€‚æ ¼å¼ä¸º [å®¿ä¸»æœºç«¯å£]:[å®¹å™¨å†…éƒ¨ç«¯å£]</p>\n<p>Bind mountsï¼šå°†å®¿ä¸»æœºç›®å½•æŒ‚åˆ°åˆ°å®¹å™¨å†…éƒ¨ç›®å½•ä¸­ã€‚æ ¼å¼ä¸º [å®¿ä¸»æœºç›®å½•]:[å®¹å™¨å†…éƒ¨ç›®å½•]ã€‚è¿™ä¸ª springboot é¡¹ç›®ä¼šå°†æ—¥å¿—æ‰“å°åœ¨å®¹å™¨ /home/developer/app/logs/ ç›®å½•ä¸‹ï¼Œå°†å®¿ä¸»æœºç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ç›®å½•åï¼Œé‚£ä¹ˆæ—¥å¿—å°±ä¼šæŒä¹…åŒ–å®¹å™¨å¤–éƒ¨çš„å®¿ä¸»æœºç›®å½•ä¸­ã€‚</p>\n</li>\n<li>\n<p>maven æ‰“ jar åŒ…</p>\n<p>mvn clean install</p>\n</li>\n<li>\n<p>è¿è¡Œ Dockerfile</p>\n<p>ä¼šå…ˆ pull åŸºç¡€é•œåƒï¼ˆæ¯”å¦‚ openjdkï¼‰ï¼Œç„¶åå†æ‰“åŒ…é•œåƒï¼Œå¹¶å°†é•œåƒéƒ¨ç½²åˆ°è¿œç¨‹ docker è¿è¡Œ</p>\n<p>æˆåŠŸåå¯ä»¥çœ‹åˆ°é•œåƒåä¸º docker-demo:1.1ï¼Œå®¹å™¨åä¸º docker-server</p>\n</li>\n<li>\n<p>æŸ¥çœ‹æ—¥å¿—</p>\n<p>IDEA çš„ Docker å®¹å™¨å¯ä»¥çœ‹åˆ° Log è¾“å‡ºåˆ°äº†æ§åˆ¶å°</p>\n</li>\n</ol>\n","prev":{"title":"Ubuntu-å¼€å‘ç¯å¢ƒé…ç½®","link":"2022/11/16/Ubuntu-å¼€å‘ç¯å¢ƒé…ç½®"},"next":{"title":"ä¼˜é›…ç¼–å†™åšå®¢ - Typora+jsDelivr+Picgo+TinyPNG å®ç°å›¾ç‰‡å‹ç¼©åŠ é€Ÿä¸Šä¼ å›¾åºŠ","link":"2022/05/18/ä¼˜é›…ç¼–å†™åšå®¢-Typora-jsDelivr-Picgo-TinyPNG-å®ç°å›¾ç‰‡å‹ç¼©åŠ é€Ÿä¸Šä¼ å›¾åºŠ"},"plink":"https://blog.liumulin.top/2022/05/20/IDEA-è¿œç¨‹ä¸€é”®éƒ¨ç½²-SpringBoot-åˆ°-Docker/","toc":[{"id":"idea-è¿œç¨‹ä¸€é”®éƒ¨ç½²-springboot-åˆ°-docker","title":"IDEA è¿œç¨‹ä¸€é”®éƒ¨ç½² SpringBoot åˆ° Docker","index":"1","children":[{"id":"ä¸€ã€å¼€å‘å‡†å¤‡","title":"ä¸€ã€å¼€å‘å‡†å¤‡","index":"1.1"},{"id":"äºŒã€å»ºé¡¹ç›®","title":"äºŒã€å»ºé¡¹ç›®","index":"1.2"}]}],"reward":true,"copyright":{"custom":"ä¸è®¸è½¬è½½ğŸ˜¡ï¼ï¼ï¼"}}